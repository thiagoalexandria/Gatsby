---
title: Configuração de um servidor Apache
description: "Nesse tutorial será explicado como configurar o Apache em um servidor com CentOS 7, desde a sua instalação até a configuração de vhosts e instalação de módulos.\_Nesse artigo será utilizado a versão 2.4 do apache em uma instalação Minimal do CentOs 7."
date: '2020-01-15 05:00:23'
category: linux
background: '#EE0000'
---
1. [Configuração do hostname](#id1)
2. [Instalação e configuração do Apache](#id2)

   1. [Ajustes de configuração do sistema operacional](#id21)
   2. [Estrutura do Apache](#id22)
3. [Configuração de aplicação Web](#id3)

   1. [Instalar e configurar o modulo php](#id31)
4. [Configuração de Logs](#id4)

   1. [Funcionamento dos logs](#id41)
   2. [Criticidade de logs](#id42)
   3. [LogFormat](#id43)
   4. [CustomLog e Rotatelogs](#id44)
5. [Boas Praticas e segurança](#id5)

   1. [Páginas de erros amigáveis](#id51)
   2. [Desligar o modo Trace](#id52)
   3. [Ocultar informações do Apache](#id53)
   4. [Proteger versão PHP](#id54)
6. [Configuração de SSL](#id6)

   1. [Instalação openssl e mod_ssl](#id61)
   2. [Geração de certificado SSL self signed](#id62)
   3. [Configuração de virtualhost e Teste](#id63)
7. [Testes de carga](#id7)

   1. [Utilizando AB para teste de carga via linha de comando](#id71)
8. [Modulos](#id8)

   1. [mod_status](#id81)
   2. [mod_rewrite](#id82)
   3. [mod_sustitute](#id83)
   4. [mod_deflate](#id84)

## 1. Configuração do hostname <a name="id1"></a>

Antes de seguir com a configuração do Apache, iremos configurar o hostname do servidor da seguinte forma "meu-site.com.br" no qual você deve substituir pelo teu domínio do teu servidor, para isso será utilizado o seguinte comando:

```bash
hostnamectl set-hostname meu-site.com.br
```

Após ajustar o hostname, verifique é o nome configurado é retornado após utilizar o comando abaixo:

```bash
hostnamectl status
```

Feito isso, edite o arquivo hosts em seu /etc/hosts com o editor de sua preferência

```bash
vi /etc/hosts
```

## 2. Instalação e configuração do Apache <a name="id2"></a>

Configurado o hostname seguiremos com a instalação e configuração do serviço web no servidor, para isso basta seguir com a instalação do serviço httpd e alguns utilitários através do gerenciador de pacotes:

```bash
yum install -y httpd wget htop
```

Feito a instalação utilizando o gerenciador de pacotes inicie o serviço para verificar o seu funcionamento

```bash
systemctl start httpd
systemctl status httpd
```

### 2.1 Ajustes de configuração do sistema operacional <a name="id21"></a>

Para que o servidor funcione sem maiores problemas é necessário seguir alguns passos para liberação de porta no firewall e desativar o selinux para não realizar bloqueios nas aplicações, dessa forma escolha a forma com que se sente mais familiarizado :

A: Desabilite o firewalld e utilize o iptables como firewall

```bash  
systemctl stop firewalld
systemctl disable firewalld
```

Nesse teste iremos utilizar apenas ipv4 então desativaremos as configurações de ipv6 do iptables e das configurações de rede:

```bash
service ip6tables stop
chkconfig ip6tables off
sed -i 's/IPV6INIT\=\"yes\"/IPV6INIT\=\"no\"/g' /etc/sysconfig/network-scripts/ifcfg-eth0
echo -e 'net.ipv6.conf.all.disable_ipv6 = 1\n' >> /etc/sysctl.conf
echo -e 'NETWORKING_IPV6=no\n' >> /etc/sysconfig/network
```

  Após feito, liberar a porta 80 e 443 no iptables:

```bash
iptables -I INPUT -p tcp --dport 80 -j ACCEPT
iptables -I INPUT -p tcp --dport 443 -j ACCEPT
 /sbin/service iptables save 
```

B: Liberar a porta 80 e 443 no firewalld

```bash
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --permanent --add-port=443/tcp
firewall-cmd --reload
```

Configurado  o firewall será feito o ajuste dos limites de segurança e desativação do selinux no servidor, para isso siga com o passo determinado abaixo:

```bash
echo -e '* soft    nofile  1024\n' >> /etc/security/limits.conf
echo -e '* hard    nofile  65535\n' >> /etc/security/limits.conf
echo -e 'sesssion required /lib64/security/pam_limits.so\n' >> /etc/pam.d/login
echo -e 'fs.file-max = 65535\n' >> /etc/sysctl.conf
sed -i "s/SELINUX=.*/SELINUX=disabled/" /etc/sysconfig/selinux
```

### 2.2 Estrutura do Apache <a name="id22"> </a>

O Apache, assim como todo outro serviço possui caminho para os seus arquivos de configuração, para acessar esses arquivos basta seguir com o acesso ao seguinte diretório:

```bash
/etc/httpd
```

Nesse diretório é possível verificar alguns outros diretórios responsáveis pela estrutura do apache, são esses os conf, conf.d, logs, modules e run, abaixo é possível verificar as configurações armazenadas:

```bash
# Arquivo de configuração principal, responsável por iniciar e determinar as configurações iniciais do serviço Web
/etc/httpd/conf
# Diretório para realização de includes de configuração
/etc/httpd/conf.d
# Diretório padrão para armazenamento de logs
logs -> ../../var/log/httpd
# Link simbólico para as bibliotecas de módulos instalados
modules -> ../../usr/lib64/apache2/modules
# Informações sobre o processo ativo
run -> ../../var/run/apache2
```

## 3. Configuração de aplicação Web<a name="id3"></a>


###3.1 Instalar e configurar o modulo php<a name="id31"></a>

Nesse passo não se tem restrições, caso deseje instalar a versão disponibilizada pelo yum basta seguir com a instalação, para verificar qual a versão disponível basta verificar utilizando a opção info do gerenciador de pacotes:

```bash
yum info php
```

Se estiver de acordo, basta seguir com a instalação:

```bash
yum install php
```

Como a versão disponibilizada já encontra-se em end-of-life será instalado a versão 7.0 do php, para isso basta seguir os seguintes passos, ativando os repositórios Epel e Remi:

```bash
yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
yum install http://rpms.remirepo.net/enterprise/remi-release-7.rpm
```

Em seguida é necessário instalar o yum-utils, para poder manusear os repositórios e pacotes que serão instalados:

```bash
yum install yum-utils
```

Instalado o yum-utils,  basta escolher a versão do PHP que deseja, para isso selecione o pacote:

```bash
yum-config-manager --enable remo-php70   [Install PHP 7.0]
yum-config-manager --enable remi-php71   [Install PHP 7.1]
yum-config-manager --enable remi-php72   [Install PHP 7.2]
yum-config-manager --enable remi-php73   [Install PHP 7.3]
```bash

Configurado a versão siga com a instalação dos módulos:

```bash
yum install php php-mcrypt php-cli php-gd php-curl php-mysql php-ldap php-zip php-fileinfo
```

Certifique-se de que a versão foi instalada corretamente:

```bash
php -v
```
